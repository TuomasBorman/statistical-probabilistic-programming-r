<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to Probabilistic Programming in R: Gaussian processes</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../gaussian-processes.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to Probabilistic Programming in R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to Probabilistic Programming in R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Probabilistic Programming in R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 71%" class="percentage">
    71%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 71%" aria-valuenow="71" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../gaussian-processes.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="bayesian-statistics.html">1. Short introduction to Bayesian statistics</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="stan.html">2. Stan</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="mcmc.html">3. MCMC</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="hierarchical-models.html">4. Hierarchical Models</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="model-critisism.html">5. Model checking</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Gaussian processes
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#gaussian-process-regression">Gaussian process regression</a></li>
<li><a href="#cholesky-parameterization">Cholesky parameterization</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="other-topics.html">7. Other topics</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="exercises.html">8. Exercises</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/model-critisism.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/other-topics.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/model-critisism.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Model checking
        </a>
        <a class="chapter-link float-end" href="../instructor/other-topics.html" rel="next">
          Next: Other topics... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Gaussian processes</h1>
        <p>Last updated on 2024-04-08 |
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/gaussian-processes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 61 minutes</p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How to do probabilistic non-parameteric regression?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn to perform Gaussian process regression with Stan</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Gaussian processes (GPs) represent a class of stochastic (random)
processes widely employed for non-parametric regression.</p>
<p>Formally, a Gaussian process <span class="math inline">\(GP(\mu,
\Sigma)\)</span> is characterized as a collection of random variables
<span class="math inline">\(X\)</span> such that any finite subset <span class="math inline">\(X_I \subset X\)</span> follows a multivariate
normal distribution with mean <span class="math inline">\(\mu\)</span>
and covariance <span class="math inline">\(\Sigma\)</span>. Generating a
sample from a GP yields a random function <span class="math inline">\(X_I \to \mathbb{R}\)</span>, and this feature
enables using GPs as prior distributions for functions.</p>
<p>As an example, consider the modeling of crop yields as a function of
fertilizer use. Presumably, there exists a non-linear trend between
these variables, as insufficient or excessive fertilizer may lead to
suboptimal yields. In the absence of a parametric mechanistic model, GPs
can function as a prior for the relationship <span class="math inline">\(f\)</span> between fertilizer and yield. In its
simplest form, measured yields could be modeled as noisy observations
from <span class="math inline">\(f\)</span>: <span class="math display">\[ f(x) \sim GP(\mu, \Sigma),\]</span></p>
<p>where <span class="math inline">\(x\)</span> represents the amount of
fertilizer used.</p>
<p>As with all priors, the chosen hyperparameters (here <span class="math inline">\(\mu, \, \Sigma\)</span>) influence the inference.
The mean parameter <span class="math inline">\(\mu\)</span> defines the
average level of the process, while the covariance function <span class="math inline">\(\Sigma\)</span> exerts a more defining effect on
the process characteristics.</p>
<p>Perhaps the most frequently used covariance function is the squared
exponential kernel <span class="math inline">\(K_{SE}(x, x’) = \alpha^2
\exp^{ \frac{(x - x’)^2}{2 \lambda} }\)</span>. The parameter <span class="math inline">\(\alpha\)</span> sets the variance of the process,
and <span class="math inline">\(\lambda\)</span> determines the scale of
the correlation; increasing <span class="math inline">\(\lambda\)</span>
increases the correlation between <span class="math inline">\(x\)</span>
and <span class="math inline">\(x’\)</span>. In the figure below, we’ve
plotted some realizations from a GP with <span class="math inline">\(\mu
= (0, 0, \ldots, 0)\)</span> and squared exponential covariance function
with <span class="math inline">\(\alpha = 1\)</span> and <span class="math inline">\(\lambda = 25\)</span>. The input space <span class="math inline">\(X_I\)</span> is the integers between 0 and
100.</p>
<figure><img src="../fig/gaussian-processes-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>Generate samples from the GP above with different values of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\lambda\)</span> to get intuition about the role
of these hyperparameters.</p>
</div>
</div>
</div>
<p>Next, we’ll explore some simple examples that leverage Gaussian
processes.</p>
<section id="gaussian-process-regression"><h2 class="section-heading">Gaussian process regression<a class="anchor" aria-label="anchor" href="#gaussian-process-regression"></a>
</h2>
<hr class="half-width"><p>Assume we have 5 data available and wed like to estimate a trend in
the data.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">2.76</span>, <span class="fl">2.46</span>, <span class="op">-</span><span class="fl">1.52</span>, <span class="op">-</span><span class="fl">4.34</span>, <span class="fl">4.54</span>,  <span class="fl">1</span><span class="op">)</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="op">-</span><span class="fl">0.81</span>, <span class="op">-</span><span class="fl">0.85</span>, <span class="fl">0.76</span>, <span class="op">-</span><span class="fl">0.41</span>, <span class="op">-</span><span class="fl">1.48</span>,  <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot data</span></span>
<span><span class="va">p_data</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_data</span></span></code></pre>
</div>
<figure><img src="../fig/gaussian-processes-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Let’s assume these are noisy observations from some unknown function
<span class="math inline">\(f\)</span> and try to estimate this function
by giving <span class="math inline">\(f\)</span> a Gaussian process
prior with the squared exponential covariance function.</p>
<p>The covariance function should be computed using the data points
<span class="math inline">\(x\)</span> and all those locations where we
want to predict the value of <span class="math inline">\(f\)</span>.
Let’s predict the <span class="math inline">\(f\)</span> on a grid of
points spanning the interval (-5, 5). The grid points are stored in
vector <code>x_pred</code></p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_pred</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">x_pred</span> <span class="op">&lt;-</span> <span class="fu">seq</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">N_pred</span><span class="op">)</span></span></code></pre>
</div>
<p>Next we’ll build the Stan program. The model structure is simple; the
model block defines the likelihood as the normal distribution with an
unknown mean: <code>y ~ normal(f[1:N_data], sigma);</code>. Notice that
this is a vectorized statement so the mean of each <span class="math inline">\(y_i\)</span> equals <span class="math inline">\(f_i\)</span>.</p>
<p>The parameter vector <code>f</code> contains the values of <span class="math inline">\(f\)</span> corresponding to the data points and
then concatenated the values corresponding to the prediction locations.
The covariance function is computed in the transformed data block, where
first a vector of concatenated data and prediction locations is
build.</p>
<p>Take a moment to digest the structure of the Stan program.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="co">// Data</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_data;</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="dt">real</span> y[N_data];</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="dt">real</span> x_data[N_data];</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="co">// GP hyperparameters</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; alpha;</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; lambda;</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="co">// Observation erro</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="co">// Prediction points</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_pred;</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="dt">real</span> x_pred[N_pred];</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N = N_data + N_pred;</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  </span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="dt">real</span> x[N];</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="dt">matrix</span>[N, N] K;</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  x[<span class="dv">1</span>:N_data] = x_data;</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>  x[(N_data+<span class="dv">1</span>):N] = x_pred;</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  <span class="co">// Covariance function</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  K = gp_exp_quad_cov(x, alpha, lambda);</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="co">// Add nugget on diagonal for numerical stability</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    K[n, n] = K[n, n] + <span class="fl">1e-6</span>;</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  }</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>}</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  <span class="dt">vector</span>[N] f;</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>}</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>  y ~ normal(f[<span class="dv">1</span>:N_data], sigma);</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>  <span class="co">// GP</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>  f ~ multi_normal(rep_vector(<span class="dv">0</span>, N), K);</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>}</span></code></pre>
</div>
<p>Let’s fit the model.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit</span></span>
<span><span class="va">gp_samples</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu">sampling</span><span class="op">(</span><span class="va">gp_model</span>,</span>
<span>                       <span class="fu">list</span><span class="op">(</span>N_data <span class="op">=</span> <span class="va">N</span>,</span>
<span>                            x_data <span class="op">=</span> <span class="fu">as.array</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                            y <span class="op">=</span> <span class="fu">as.array</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>                            lambda <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            sigma <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                            N_pred <span class="op">=</span> <span class="va">N_pred</span>,</span>
<span>                            x_pred <span class="op">=</span> <span class="va">x_pred</span><span class="op">)</span>,</span>
<span>                       chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>                       refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: There were 357 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: The largest R-hat is 2.04, indicating chains have not mixed.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#r-hat</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
</div>
<p>The inference takes time (minutes) even though we only use (an
insufficient) single chain and 1000 iterations. There are also some
convergence issues. Let’s ignore these at this point, and look at the
output.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_samples</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu">extract</span><span class="op">(</span><span class="va">gp_samples</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">[[</span><span class="st">"f"</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">t</span> <span class="op">%&gt;%</span> <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span>, <span class="va">x_pred</span><span class="op">)</span><span class="op">)</span> <span class="co"># data and prediction locations</span></span>
<span></span>
<span><span class="va">f_samples_l</span> <span class="op">&lt;-</span> <span class="va">f_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"sample"</span>, value <span class="op">=</span> <span class="st">"f"</span>, <span class="op">-</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_f</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">f_samples_l</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">f</span>, group <span class="op">=</span> <span class="va">sample</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, </span>
<span>             <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span><span class="st">"red"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">p_f</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/gaussian-processes-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The figure contains the data points in red and samples from the
posterior distribution of <span class="math inline">\(f\)</span> in
black. Note that each posterior sample corresponds to a function. This
distribution essentially encapsulates the model’s interpretation of the
underlying trend within the data. The estimate for the trend seems
plausible. The posterior in certain regions, however, seems a bit
strange. For example, the posterior between the farthest two data points
on the right contains most of the mass above the line connecting the
points. This is likely a symptom of the convergence issues.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>In the figure above, where is the posterior uncertainty the highest
and why? What controls the uncertainty at the locations of the data? If
the made the prediction range wider, say, from -10 to 10, what would
look like at the extremes?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Uncertainty grows at locations away from the data points and starts
to resemble the prior. Posterior far from the data would be centered
around 0 and have variance <span class="math inline">\(\alpha^2\)</span>.</p>
</div>
</div>
</div>
</div>
</section><section id="cholesky-parameterization"><h2 class="section-heading">Cholesky parameterization<a class="anchor" aria-label="anchor" href="#cholesky-parameterization"></a>
</h2>
<hr class="half-width"><p>It is generally recommended, that GPs are used with the Cholesky
parameterization. This considerable improves in inference and enhanced
convergence. In essence, this parameterization suggests that if <span class="math inline">\(\eta\)</span> follows a multivariate normal
distribution with zero mean and identity covariance, then expressing
<span class="math inline">\(f\)</span> as <span class="math inline">\(f
= \mu + L\eta\)</span> defines a GP with mean <span class="math inline">\(\mu\)</span> and covariance <span class="math inline">\(LL^T = K\)</span>. The left-hand side of the
formula, <span class="math inline">\(LL^T\)</span> is the Cholesky
decomposition of <span class="math inline">\(K\)</span>.</p>
<p>The Stan program below implements this parameterization. Let’s
compile and fit this model on the same data.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">STAN<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode stan" tabindex="0"><code class="sourceCode stan"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="co">// Data</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_data;</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="dt">real</span> y[N_data];</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="dt">real</span> x_data[N_data];</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="co">// GP hyperparameters</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; alpha;</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; lambda;</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  </span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  </span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="co">// Prediction points</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_pred;</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  <span class="dt">real</span> x_pred[N_pred];</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>}</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N = N_data + N_pred;</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  </span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>  <span class="dt">real</span> x[N];</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  <span class="dt">matrix</span>[N, N] K;</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  <span class="dt">matrix</span>[N, N] L;</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>  </span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>  x[<span class="dv">1</span>:N_data] = x_data;</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>  x[(N_data+<span class="dv">1</span>):N] = x_pred;</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>  <span class="co">// Covariance function</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>  K = gp_exp_quad_cov(x, alpha, lambda);</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>  </span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>  <span class="co">// Add nugget on diagonal for numerical stability</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>    K[n, n] = K[n, n] + <span class="fl">1e-6</span>;</span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>  }</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>  L = cholesky_decompose(K);</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>}</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>  <span class="dt">vector</span>[N] eta;</span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>}</span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>  <span class="co">// mu = (0, 0, ..., 0)</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>  <span class="dt">vector</span>[N] f = L*eta;</span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>}</span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>  <span class="co">// Likelihood</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>  y ~ normal(f[<span class="dv">1</span>:N_data], sigma);</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a>  <span class="co">// GP</span></span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a>  eta ~ normal(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>}</span></code></pre>
</div>
<p>Fitting is completed in a few seconds with no convergence issues:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gp_cholesky_samples</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu">sampling</span><span class="op">(</span><span class="va">gp_cholesky_model</span>,</span>
<span>                       <span class="fu">list</span><span class="op">(</span>N_data <span class="op">=</span> <span class="va">N</span>,</span>
<span>                            x_data <span class="op">=</span> <span class="fu">as.array</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,</span>
<span>                            y <span class="op">=</span> <span class="fu">as.array</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,</span>
<span>                            lambda <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            sigma <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                            N_pred <span class="op">=</span> <span class="va">N_pred</span>,</span>
<span>                            x_pred <span class="op">=</span> <span class="va">x_pred</span><span class="op">)</span>,</span>
<span>                       chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">2000</span>, </span>
<span>                       refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s check the results</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_cholesky_samples</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu">extract</span><span class="op">(</span><span class="va">gp_cholesky_samples</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">[[</span><span class="st">"f"</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="va">t</span> <span class="op">%&gt;%</span> <span class="fu">data.frame</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span>, <span class="va">x_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f_cholesky_samples_l</span> <span class="op">&lt;-</span> <span class="va">f_cholesky_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather</span><span class="op">(</span>key <span class="op">=</span> <span class="st">"sample"</span>, value <span class="op">=</span> <span class="st">"f"</span>, <span class="op">-</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_cholesky_f</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">f_cholesky_samples_l</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">f</span>, group <span class="op">=</span> <span class="va">sample</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, </span>
<span>             <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span><span class="st">"red"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">p_cholesky_f</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/gaussian-processes-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion2"></a>
</h3>
<div class="callout-content">
<p>The logistic regression models a binary variable <span class="math inline">\(y \in \{0, 1\}\)</span> as a function of <span class="math inline">\(x \in \mathbb{R}\)</span> as follows:</p>
<p><span class="math display">\[ y \sim \text{Bernoulli}(\theta) \\
\theta = \frac{1}{1 + e^{-(\alpha + \beta x)}},\]</span> where <span class="math inline">\(\alpha, \beta\)</span> are real numbers and <span class="math inline">\(\theta\)</span> is the probability of <span class="math inline">\(y = 1\)</span>.</p>
<p>The model can be used to estimate, for instance, the probability of
passing an exam (<span class="math inline">\(y=1\)</span>) based on the
number of study hours <span class="math inline">\(x\)</span>.
Presumably, low study hours give low probability for passing. On the
other hand, too much study may induce exhaustion and compromise
performance.</p>
<p>Using the following data, estimate the probability of passing as a
function of study hours.</p>
<p>FIXME data</p>
<p>Modify the logistic regression so that the term <span class="math inline">\(\beta x\)</span> is replaced with a non-parametric
function <span class="math inline">\(f\)</span>. Give <span class="math inline">\(f\)</span> a GP prior with squared exponential
covariance function and appropriate hyperparameters. Use a normal prior
<span class="math inline">\(N(0, 1)\)</span> for the baseline parameter
<span class="math inline">\(\alpha\)</span>.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>point 1</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/model-critisism.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/other-topics.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/model-critisism.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Model checking
        </a>
        <a class="chapter-link float-end" href="../instructor/other-topics.html" rel="next">
          Next: Other topics... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/edit/main/episodes/gaussian-processes.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/statistical-probabilistic-programming-r/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:velait@utu.fi">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.3" class="external-link">sandpaper (0.16.3)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.4" class="external-link">pegboard (0.7.4)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/gaussian-processes.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Gaussian processes",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/gaussian-processes.html",
  "identifier": "https://carpentries-incubator.github.io/statistical-probabilistic-programming-r/instructor/gaussian-processes.html",
  "dateCreated": "2024-04-08",
  "dateModified": "2024-04-08",
  "datePublished": "2024-04-09"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

